if not _G.charSelectExists then return 0 end

local MARIO_MOUTH_NORMAL, MARIO_MOUTH_HAPPY, MARIO_MOUTH_SMILE, MARIO_MOUTH_FROWN = 0, 1, 2, 3
local MARIO_EYES_SHOCKED, MARIO_EYES_CLOSED_INTENSE, MARIO_EYES_ANGRY = 9, 10, 11

CHAR_ANIM_KIRBY_INHALE_IDLE = CHAR_ANIM_MAX + 19920
CHAR_ANIM_KIRBY_INHALE_MOVE = CHAR_ANIM_MAX + 19921
CHAR_ANIM_KIRBY_HELLO = CHAR_ANIM_MAX + 19922
kirbyAnims = {
	mouth = {
		
		[CHAR_ANIM_IDLE_ON_POLE] = MARIO_MOUTH_SMILE, 
		[CHAR_ANIM_CREDITS_WAVING] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_CREDITS_TAKE_OFF_CAP] = function (m, frame) if frame > 10 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_FINAL_BOWSER_RAISE_HAND_SPIN] = function (m, frame) if frame > 40 and frame < 62 then return MARIO_MOUTH_SMILE end return MARIO_MOUTH_HAPPY end, 
		[CHAR_ANIM_FINAL_BOWSER_WING_CAP_TAKE_OFF] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_CREDITS_PEACE_SIGN] = function (m, frame) if frame > 97 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_WING_CAP_FLY] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_HANG_ON_OWL] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_LAND_ON_STOMACH] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_THROW_CATCH_KEY] = function (m, frame) if frame > 34 and frame < 60 then return MARIO_MOUTH_HAPPY elseif frame >= 60 then return MARIO_MOUTH_SMILE end return MARIO_MOUTH_NORMAL end, 
		[CHAR_ANIM_TRIPLE_JUMP_GROUND_POUND] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_START_GROUND_POUND] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_GROUND_POUND] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_BOTTOM_STUCK_IN_GROUND] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_RIDING_SHELL] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_WALKING] = MARIO_MOUTH_SMILE, 
		[CHAR_ANIM_JUMP_RIDING_SHELL] = MARIO_MOUTH_SMILE, 
		[CHAR_ANIM_BEND_KNESS_RIDING_SHELL] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_FLY_FROM_CANNON] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_PUSHING] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_IDLE_IN_QUICKSAND] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_IDLE_HEAVY_OBJ] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_CROUCHING] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_SUMMON_STAR] = function (m, frame) if frame > 27 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_WATER_STAR_DANCE] = function (m, frame) if frame > 64 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_CROUCHING] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_GRAB_BOWSER] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_RELEASE_BOWSER] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_WALK_WITH_HEAVY_OBJ] = MARIO_MOUTH_FROWN, 
		[CHAR_ANIM_SLIDEJUMP] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_START_WALLKICK] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_FORWARD_SPINNING_FLIP] = function (m, frame) if frame > 10 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_TRIPLE_JUMP_FLY] = MARIO_MOUTH_SMILE, 
		[charSelect.CS_ANIM_MENU] = MARIO_MOUTH_HAPPY, 
		[CHAR_ANIM_STAR_DANCE] = function (m, frame) if frame > 48 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_TAKE_CAP_OFF_THEN_ON] = function (m, frame) if frame > 30 then return MARIO_MOUTH_SMILE end return MARIO_MOUTH_NORMAL end, 
		[CHAR_ANIM_MISSING_CAP] =          function (m, frame) if frame > 30 then return MARIO_MOUTH_SMILE end return MARIO_MOUTH_NORMAL end, 
		[CHAR_ANIM_KIRBY_HELLO] = function (m, frame) if frame > 5 and frame < 48 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_PUT_CAP_ON] = function (m, frame) if frame > 9 and frame < 20 then return MARIO_MOUTH_HAPPY end return MARIO_MOUTH_SMILE end, 
		[CHAR_ANIM_FIRST_PERSON] = function (m, frame) if m.action == ACT_CREDITS_CUTSCENE or m.action == ACT_FIRST_PERSON or m.action == ACT_INTRO_CUTSCENE then return MARIO_MOUTH_NORMAL end return MARIO_MOUTH_FROWN end, 
		[CHAR_ANIM_CREDITS_LOOK_UP] = MARIO_MOUTH_SMILE, 
		[CHAR_ANIM_IDLE_HEAD_LEFT] = function (m, frame) if _G.charSelect.character_get_current_costume(m.playerIndex) == kirbyRetroCosID then return MARIO_MOUTH_SMILE end return MARIO_MOUTH_NORMAL end, -- TODO: The smile is appearing on other kirby players, specifically using the modern design.
		[CHAR_ANIM_IDLE_HEAD_RIGHT] = function (m, frame) if _G.charSelect.character_get_current_costume(m.playerIndex) == kirbyRetroCosID then return MARIO_MOUTH_SMILE end return MARIO_MOUTH_NORMAL end, 
		[CHAR_ANIM_IDLE_HEAD_CENTER] = function (m, frame) if _G.charSelect.character_get_current_costume(m.playerIndex) == kirbyRetroCosID then return MARIO_MOUTH_SMILE end return MARIO_MOUTH_NORMAL end, 
	}, 
	eyes = {
		[CHAR_ANIM_FINAL_BOWSER_RAISE_HAND_SPIN] = function (m, frame) if frame > 62 and frame < 99 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_FALL_OVER_BACKWARDS] = function (m, frame) if frame < 40 then return MARIO_EYES_SHOCKED end return MARIO_EYES_CLOSED_INTENSE end, 
		[CHAR_ANIM_BACKWARD_AIR_KB] = MARIO_EYES_SHOCKED, 
		[CHAR_ANIM_A_POSE] = MARIO_EYES_SHOCKED, 
		[CHAR_ANIM_SKID_ON_GROUND] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_CREDITS_RAISE_HAND] = function (m, frame) if frame > 68 then return MARIO_EYES_SHOCKED end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_CREDITS_LOWER_HAND] = MARIO_EYES_SHOCKED, 
		[CHAR_ANIM_CREDITS_PEACE_SIGN] = function (m, frame) if frame < 50 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_STAND_UP_FROM_LAVA_BOOST] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_LAND_ON_STOMACH] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_AIR_FORWARD_KB] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_COUGHING] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_THROW_CATCH_KEY] = function (m, frame) if frame > 60 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_HEAD_STUCK_IN_GROUND] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_TRIPLE_JUMP_GROUND_POUND] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_START_GROUND_POUND] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_GROUND_POUND] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_JUMP_RIDING_SHELL] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_LEGS_STUCK_IN_GROUND] = MARIO_EYES_SHOCKED, 
		[CHAR_ANIM_FIRE_LAVA_BURN] = MARIO_EYES_DEAD, 
		[CHAR_ANIM_BEING_GRABBED] = MARIO_EYES_SHOCKED, 
		[CHAR_ANIM_GRAB_HEAVY_OBJECT] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_PUSHING] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_SOFT_BACK_KB] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_SOFT_FRONT_KB] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_DYING_IN_QUICKSAND] = MARIO_EYES_SHOCKED, 
		[CHAR_ANIM_BACKWARD_KB] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_FORWARD_KB] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_IDLE_HEAVY_OBJ] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_GROUND_BONK] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_BACKWARDS_WATER_KB] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_DROWNING_PART1] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_WATER_FORWARD_KB] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_WATER_STAR_DANCE] = function (m, frame) if frame > 18 and frame < 50 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_GRAB_BOWSER] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_SWINGING_BOWSER] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_HOLDING_BOWSER] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_HEAVY_THROW] = function (m, frame) if frame < 10 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_ANGRY end, 
		[CHAR_ANIM_WALK_WITH_HEAVY_OBJ] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_TURNING_PART1] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_TURNING_PART2] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_STAR_DANCE] = function (m, frame) if frame < 5 then return MARIO_EYES_BLINK elseif frame >= 5 and frame < 29 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_TAKE_CAP_OFF_THEN_ON] = function (m, frame) if frame > 5 and frame < 30 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_MISSING_CAP] =          function (m, frame) if frame > 5 and frame < 30 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_KIRBY_INHALE_IDLE] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_DOUBLE_JUMP_RISE] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_DOUBLE_JUMP_FALL] = function (m, frame) if gPlayerSyncTable[m.playerIndex].kirbyPuffTimer_JJJ > 240 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_SLIDE_KICK] = MARIO_EYES_ANGRY, 
		[CHAR_ANIM_RELEASE_BOWSER] = MARIO_EYES_CLOSED_INTENSE, 
		[CHAR_ANIM_AIR_KICK] = function (m, frame) if frame < 5 then return MARIO_EYES_CLOSED_INTENSE end return MARIO_EYES_BLINK end, 
		[CHAR_ANIM_CROUCHING] = MARIO_EYES_CLOSED_INTENSE, 
	}, 
	anims = {
		[CHAR_ANIM_SINGLE_JUMP] = "KIRBY_JUMP", 
		[CHAR_ANIM_LAND_FROM_SINGLE_JUMP] = "KIRBY_LAND", 
		[CHAR_ANIM_GENERAL_FALL] = "KIRBY_FALL", 
		[CHAR_ANIM_GENERAL_LAND] = "KIRBY_LAND", 
		[CHAR_ANIM_WALKING] = "KIRBY_WALK", 
		[CHAR_ANIM_START_CROUCHING] = "KIRBY_CROUCH", 
		[CHAR_ANIM_CROUCHING] = "KIRBY_CROUCH", 
		[CHAR_ANIM_CROUCH_FROM_SLIDE_KICK] = "KIRBY_SLIDE_TO_CROUCH", 
		[CHAR_ANIM_IDLE_HEAD_LEFT] = "KIRBY_IDLE", 
		[CHAR_ANIM_IDLE_HEAD_RIGHT] = "KIRBY_IDLE", 
		[CHAR_ANIM_IDLE_HEAD_CENTER] = "KIRBY_IDLE", 
		[CHAR_ANIM_STOP_CROUCHING] = "KIRBY_CROUCH", 
		[CHAR_ANIM_KIRBY_INHALE_IDLE] = "KIRBY_INHALE_IDLE", 
		[CHAR_ANIM_KIRBY_INHALE_MOVE] = "KIRBY_INHALE_MOVE", 
		[CHAR_ANIM_AIRBORNE_ON_STOMACH] = "KIRBY_LONG_FALL", 
		[CHAR_ANIM_DOUBLE_JUMP_FALL] = "KIRBY_PUFF_IDLE", 
		[CHAR_ANIM_DOUBLE_JUMP_RISE] = "KIRBY_PUFF_UP", 
		[CHAR_ANIM_AIR_KICK] = "KIRBY_PUFF_OUT", 
		[CHAR_ANIM_RUNNING] = "KIRBY_RUN", 
		[CHAR_ANIM_RUNNING_UNUSED] = "KIRBY_RUN", 
		[CHAR_ANIM_SLIDE_KICK] = "KIRBY_SLIDE_KICK", 
		[CHAR_ANIM_FIRST_PERSON] = "KIRBY_IDLE", 
		[CHAR_ANIM_PUT_CAP_ON] = "KIRBY_POWER_UP", 
		[charSelect.CS_ANIM_MENU] = "KIRBY_MENU", 
		[CHAR_ANIM_STAR_DANCE] = "KIRBY_CELEBRATION", 
		[CHAR_ANIM_RETURN_FROM_STAR_DANCE] = "KIRBY_IDLE", 
		[CHAR_ANIM_MISSING_CAP] = "KIRBY_EXIT_LAND", 
		[CHAR_ANIM_TAKE_CAP_OFF_THEN_ON] = "KIRBY_EXIT_LAND", 
		[CHAR_ANIM_KIRBY_HELLO] = "KIRBY_HELLO", 
	}, 
}